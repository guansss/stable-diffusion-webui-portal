(()=>{var e={227:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,o=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(o=r))})),t.splice(o,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(447)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,n)=>{e.exports=function(e){function t(e){let n,o,s,i=null;function a(...e){if(!a.enabled)return;const r=a,o=Number(new Date),s=o-(n||o);r.diff=s,r.prev=n,r.curr=o,n=o,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let i=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,o)=>{if("%%"===n)return"%";i++;const s=t.formatters[o];if("function"==typeof s){const t=e[i];n=s.call(r,t),e.splice(i,1),i--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==i?i:(o!==t.namespaces&&(o=t.namespaces,s=t.enabled(e)),s),set:e=>{i=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function o(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(o),...t.skips.map(o).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),o=r.length;for(n=0;n<o;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},824:e=>{var t=1e3,n=60*t,r=60*n,o=24*r;function s(e,t,n,r){var o=t>=1.5*n;return Math.round(e/n)+" "+r+(o?"s":"")}e.exports=function(e,i){i=i||{};var a,c,l=typeof e;if("string"===l&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(s){var i=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*i;case"weeks":case"week":case"w":return 6048e5*i;case"days":case"day":case"d":return i*o;case"hours":case"hour":case"hrs":case"hr":case"h":return i*r;case"minutes":case"minute":case"mins":case"min":case"m":return i*n;case"seconds":case"second":case"secs":case"sec":case"s":return i*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return i;default:return}}}}(e);if("number"===l&&isFinite(e))return i.long?(a=e,(c=Math.abs(a))>=o?s(a,c,o,"day"):c>=r?s(a,c,r,"hour"):c>=n?s(a,c,n,"minute"):c>=t?s(a,c,t,"second"):a+" ms"):function(e){var s=Math.abs(e);return s>=o?Math.round(e/o)+"d":s>=r?Math.round(e/r)+"h":s>=n?Math.round(e/n)+"m":s>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var s=t[r]={exports:{}};return e[r](s,s.exports,n),s.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(227);const t=n.n(e)()("sd-portal");function r(e){return e.startsWith("data:")?e.slice(0,80)+"...":e}const o=new Promise((e=>{onUiLoaded(e)})),s="object"==typeof global&&global&&global.Object===Object&&global;var i="object"==typeof self&&self&&self.Object===Object&&self;const a=s||i||Function("return this")(),c=a.Symbol,l=Array.isArray;var u=Object.prototype,d=u.hasOwnProperty,f=u.toString,p=c?c.toStringTag:void 0;var g=Object.prototype.toString;var h=c?c.toStringTag:void 0;const m=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":h&&h in Object(e)?function(e){var t=d.call(e,p),n=e[p];try{e[p]=void 0;var r=!0}catch(e){}var o=f.call(e);return r&&(t?e[p]=n:delete e[p]),o}(e):function(e){return g.call(e)}(e)};var v=c?c.prototype:void 0,y=v?v.toString:void 0;const C=function e(t){if("string"==typeof t)return t;if(l(t))return function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o}(t,e)+"";if(function(e){return"symbol"==typeof e||function(e){return null!=e&&"object"==typeof e}(e)&&"[object Symbol]"==m(e)}(t))return y?y.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};var b=0;const w=function(e){var t,n=++b;return(null==(t=e)?"":C(t))+n},_=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)},F=a["__core-js_shared__"];var E,j=(E=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+E:"";var O=Function.prototype.toString;var x=/^\[object .+?Constructor\]$/,P=Function.prototype,L=Object.prototype,S=P.toString,T=L.hasOwnProperty,k=RegExp("^"+S.call(T).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const A=function(e){return!(!_(e)||(t=e,j&&j in t))&&(function(e){if(!_(e))return!1;var t=m(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}(e)?k:x).test(function(e){if(null!=e){try{return O.call(e)}catch(e){}try{return e+""}catch(e){}}return""}(e));var t},I=function(e,t){var n=function(e,t){return null==e?void 0:e[t]}(e,t);return A(n)?n:void 0},M=I(Object,"create");var z=Object.prototype.hasOwnProperty;var $=Object.prototype.hasOwnProperty;function N(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}N.prototype.clear=function(){this.__data__=M?M(null):{},this.size=0},N.prototype.delete=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t},N.prototype.get=function(e){var t=this.__data__;if(M){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return z.call(t,e)?t[e]:void 0},N.prototype.has=function(e){var t=this.__data__;return M?void 0!==t[e]:$.call(t,e)},N.prototype.set=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=M&&void 0===t?"__lodash_hash_undefined__":t,this};const B=N,R=function(e,t){for(var n=e.length;n--;)if((r=e[n][0])===(o=t)||r!=r&&o!=o)return n;var r,o;return-1};var U=Array.prototype.splice;function D(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}D.prototype.clear=function(){this.__data__=[],this.size=0},D.prototype.delete=function(e){var t=this.__data__,n=R(t,e);return!(n<0||(n==t.length-1?t.pop():U.call(t,n,1),--this.size,0))},D.prototype.get=function(e){var t=this.__data__,n=R(t,e);return n<0?void 0:t[n][1]},D.prototype.has=function(e){return R(this.__data__,e)>-1},D.prototype.set=function(e,t){var n=this.__data__,r=R(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};const H=D,W=I(a,"Map"),q=function(e,t){var n,r,o=e.__data__;return("string"==(r=typeof(n=t))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?o["string"==typeof t?"string":"hash"]:o.map};function J(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}J.prototype.clear=function(){this.size=0,this.__data__={hash:new B,map:new(W||H),string:new B}},J.prototype.delete=function(e){var t=q(this,e).delete(e);return this.size-=t?1:0,t},J.prototype.get=function(e){return q(this,e).get(e)},J.prototype.has=function(e){return q(this,e).has(e)},J.prototype.set=function(e,t){var n=q(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};const G=J;function Z(e,t){if("function"!=typeof e||null!=t&&"function"!=typeof t)throw new TypeError("Expected a function");var n=function(){var r=arguments,o=t?t.apply(this,r):r[0],s=n.cache;if(s.has(o))return s.get(o);var i=e.apply(this,r);return n.cache=s.set(o,i)||s,i};return n.cache=new(Z.Cache||G),n}Z.Cache=G;const K=Z((async()=>async function(e,n){t("Fetching",e,n);const r=await fetch(e,n);if(!r.ok)throw new Error(`Failed to fetch ${e} (${r.status})`);const o=await r.json();return t("Fetched",e,o),o}("/api/sd-portal")));const Q=6e4;function V(e){return e}const X=V,{clearTimeout:Y,setTimeout:ee}=globalThis,te=Math.random.bind(Math);const ne="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",re=new BroadcastChannel("sd-portal-channel");class oe extends MutationObserver{constructor(e){super((e=>{for(const t of e)if(this.callback(t))break})),this.callback=e}}let se,ie;async function ae(){se?.src?(t("Sending image",r(se.src)),await ue.ignoreTimeout.setAtom({image:{url:se.src}}).catch(t)):t("No image to send")}async function ce(){t("Sending live preview",r(ie??"(none)")),await ue.ignoreTimeout.setAtom({livePreview:ie?{url:ie}:void 0}).catch(t)}async function le(e){const n=e?.textContent;t("Sending progress",n),await ue.ignoreTimeout.setAtom({progress:n?{text:n}:void 0}).catch(t)}const ue=function(e,t){const n=function(e,t){const{post:n,on:r,eventNames:o=[],serialize:s=V,deserialize:i=X,resolver:a,timeout:c=Q}=t,l=new Map;let u;const d=new Proxy({},{get(t,r){if("$functions"===r)return e;const i=(...e)=>{n(s({m:r,a:e,t:"q"}))};if(o.includes(r))return i.asEvent=i,i;const a=async(...e)=>(await u,new Promise(((t,o)=>{const i=function(e=21){let t="",n=e;for(;n--;)t+=ne[64*te()|0];return t}();let a;c>=0&&(a=ee((()=>{o(new Error(`[birpc] timeout on calling "${r}"`)),l.delete(i)}),c).unref?.()),l.set(i,{resolve:t,reject:o,timeoutId:a}),n(s({m:r,a:e,i,t:"q"}))})));return a.asEvent=i,a}});return u=r((async(r,...o)=>{const c=i(r);if("q"===c.t){const{m:r,a:i}=c;let l,u;const f=a?a(r,e[r]):e[r];if(f)try{l=await f.apply(d,i)}catch(e){u=e}else u=new Error(`[birpc] function "${r}" not found`);c.i&&(u&&t.onError&&t.onError(u,r,i),n(s({t:"s",i:c.i,r:l,e:u}),...o))}else{const{i:e,r:t,e:n}=c,r=l.get(e);r&&(Y(r.timeoutId),n?r.reject(n):r.resolve(t)),l.delete(e)}})),d}(e,{on:e=>re.onmessage=t=>e(t.data),post:e=>re.postMessage(e),timeout:1e3}),r=e=>new Proxy(n,{get(t,r){const o=Reflect.get(n,r);return"function"!=typeof o?o:async(...t)=>{try{return await o.call(n,...t)}catch(t){if(!e.ignoreTimeout||!function(e){return String(e).includes("[birpc] timeout")}(t))throw t}}}});return new Proxy(n,{get:(e,t)=>"$"===t?r:"ignoreTimeout"===t?r({ignoreTimeout:!0}):Reflect.get(n,t)})}(new((()=>{var e;let n,r=[];return e=class{async initClient(){await ue.ignoreTimeout.setAtom({connected:!0}),await ae(),await ce()}constructor(){!function(e,t,n){for(var r=arguments.length>2,o=0;o<t.length;o++)n=r?t[o].call(e,n):t[o].call(e)}(this,r)}},(()=>{const o="function"==typeof Symbol&&Symbol.metadata?Object.create(null):void 0;n=[function(e,n){const r=n.name;if("symbol"==typeof r)throw new Error("Cannot log function with symbol name");return function(...n){return t(`[${r}]`,...n),e.call(this,...n)}}],function(e,t,n,r,o,s){function i(e){if(void 0!==e&&"function"!=typeof e)throw new TypeError("Function expected");return e}for(var a,c=r.kind,l="getter"===c?"get":"setter"===c?"set":"value",u=!t&&e?r.static?e:e.prototype:null,d=t||(u?Object.getOwnPropertyDescriptor(u,r.name):{}),f=!1,p=n.length-1;p>=0;p--){var g={};for(var h in r)g[h]="access"===h?{}:r[h];for(var h in r.access)g.access[h]=r.access[h];g.addInitializer=function(e){if(f)throw new TypeError("Cannot add initializers after decoration has completed");s.push(i(e||null))};var m=(0,n[p])("accessor"===c?{get:d.get,set:d.set}:d[l],g);if("accessor"===c){if(void 0===m)continue;if(null===m||"object"!=typeof m)throw new TypeError("Object expected");(a=i(m.get))&&(d.get=a),(a=i(m.set))&&(d.set=a),(a=i(m.init))&&o.unshift(a)}else(a=i(m))&&("field"===c?o.unshift(a):d[l]=a)}u&&Object.defineProperty(u,r.name,d),f=!0}(e,null,n,{kind:"method",name:"initClient",static:!1,private:!1,access:{has:e=>"initClient"in e,get:e=>e.initClient},metadata:o},null,r),o&&Object.defineProperty(e,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:o})})(),e})()));(async function(){t("Starting host"),await o,t("WebUI loaded"),await async function(){const{dir:e}=await K(),n="/file="+e+"/client/client.html";["txt2img_open_folder","img2img_open_folder","extras_open_folder"].forEach((e=>{const r=document.getElementById(e);r?function(e,n){t("Inserting open button for",e);const r=document.createElement("a");for(let t=0;t<e.attributes.length;t++){const n=e.attributes[t];r.setAttribute(n.name,n.value)}const o=e.id.split("_")[0]||w("unknownTab");r.id=o+"_open_portal",r.innerText="🖥️",r.title="Open Portal (stable-diffusion-webui-portal)",r.href=n,r.target="_blank",r.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),window.open(r.href,r.target,"width=800,height=600")})),t("Created open button",r),t("Inserting open button to",e.parentElement),e.parentElement.prepend(r)}(r,n):t("Could not find target button",e)}))}(),function(){const e=new IntersectionObserver((e=>{for(const n of e)if(n.isIntersecting){t("Image visible",n.target),se=n.target,ae();break}})),n=new oe((({target:e})=>{if(e===se)return t("Image src changed",e),ae(),!0}));onAfterUiUpdate((()=>{const r=gradioApp().querySelectorAll(".gradio-gallery > div > img");se||(se=r[0]),r.forEach((r=>{r.dataset.sdPortalModded||(r.dataset.sdPortalModded="1",r.parentElement?.classList.contains("livePreview")||(t("Observing image",r),void 0===se&&(se||(se=r),ae()),e.observe(r),n.observe(r,{attributes:!0,attributeFilter:["src"]})))}))}))}(),function(){const e=[document.getElementById("txt2img_gallery"),document.getElementById("img2img_gallery")].filter(Boolean);t("Watching live previews",e);const n=new oe((({addedNodes:e,removedNodes:r})=>{e.forEach((e=>{if(e instanceof HTMLElement&&e.classList.contains("livePreview")){t("Live preview added",e),n.observe(e,{childList:!0});const r=e.getElementsByTagName("img")[0];r&&(ie=r.src,ce())}else e instanceof HTMLImageElement&&e.parentElement?.classList.contains("livePreview")&&(t("Live preview image added",e),ie=e.src,ce())})),r.forEach((e=>{e instanceof HTMLElement&&e.classList.contains("livePreview")&&(t("Live preview removed",e),ie=void 0,ce())}))}));e.forEach((e=>{n.observe(e,{childList:!0})}))}(),function(){const e=[document.getElementById("txt2img_results"),document.getElementById("img2img_results")].filter(Boolean);t("Watching progress in containers",e);const n=new oe((({target:e,addedNodes:r,removedNodes:o})=>{r.forEach((r=>{if(r instanceof HTMLElement&&r.classList.contains("progressDiv")){t("Progress added",r),n.observe(r,{childList:!0});const e=r.getElementsByClassName("progress")[0];e&&(t("Observing progress text",e),n.observe(e,{childList:!0}))}else e instanceof HTMLElement&&e.classList.contains("progress")&&le(e)})),o.forEach((e=>{e instanceof HTMLElement&&e.classList.contains("progressDiv")&&(t("Progress removed",e),le())}))}));e.forEach((e=>{n.observe(e,{childList:!0})}))}(),ue.$functions.initClient()})().catch(t)})()})();